{% extends 'base2.html.twig' %}

{% block title %}Hello AdminController!{% endblock %}

{% block body %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    var m;
    var l;
    $(document).ready(function()
    {   
        $('#logType').click(function()
        {
            var currPage = 1;
            var log = $('#logType').val();
            if(log == "Error Logs")
            {
                l = 0;
                //$("td").css("background-color", "red");
            }
            else if(log == "Success Logs")
            {
                l = 1;
                //$("td").css("background-color", "lightgreen");
            }
            else
            {
                l='';
                //$("td").css("background-color", "silver");
            }
            $.ajax(
                {
                    type: "POST",
                    data: { type:l, module:m},
                    url: '{{( path('app_paginate') )}}?page='+currPage,
                    success: function(response)
                    {
                        console.log(response);
                        numberOfItems =response.count
                        numberOfPages = Math.ceil(numberOfItems/numberPerPage)
                        $('#list').empty().append(response.pagination)
                    
                        buildPagination(currPage)
                    },
                    error: function(response)
                    {
                        alert("Process Failed");
                        console.log("Invalid Entry For Type Detected!!!")
                    }
                });
        });
        $('#module').click(function()
        {
            var currPage = 1;
            var mod = $('#module').val();
            if(mod == "User")
            {
                m =1;
            }
            else if(mod=="Applications")
            {
                m=2;
            }
            else if(mod=="Job Postings")
            {
                m=3;
            }
            else
            {
                m='';
            }
            $.ajax(
                {
                    type: "POST",
                    data: {module:m, type:l},
                    url: '{{( path('app_paginate') )}}?page='+currPage,
                    success: function(response)
                    {
                        numberOfItems =response.count
                        numberOfPages = Math.ceil(numberOfItems/numberPerPage)
                        $('#list').empty().append(response.pagination)
                    
                        buildPagination(currPage)
                    },
                    error: function(response)
                    {
                        alert("Process Failed");
                        console.log("Invalid Entry For Module Detected!!!")
                    } 
                });
        });
    })
</script>

<script>
        var numberOfItems = 0
        var numberPerPage = 5
        var currentPage = 1
        var numberOfPages = 0
        
        function accomodatePage(clickedPage) 
        {
            if (clickedPage <= 1) { return clickedPage + 1}
            if (clickedPage >= numberOfPages) { return clickedPage -1}
            return clickedPage
        }

        function buildPagination(clickedPage) 
        {
            $('.paginator').empty()
            const currPageNum = accomodatePage(clickedPage)
            if (numberOfPages >= 3) 
            {
                for (let i=-1; i<2; i++) 
                {
                    $('.paginator').append(`<button class="btn btn-primary" value="${currPageNum+i}">${currPageNum+i}</button>`)
                }
            } 
            else 
            {
                for (let i=0; i<numberOfPages; i++) 
                {
                    $('.paginator').append(`<button class="btn btn-primary" value="${i+1}">${i+1}</button>`)
                }
            }
        }

        function buildPage(currPage) 
        {
            $.ajax(
                {
                    type: 'POST',
                    data:{module:m,type:l,page:currPage},
                    url: '{{( path('app_paginate') )}}',
                    success: function(response)
                    {
                        numberOfItems =response.count
                        numberOfPages = Math.ceil(numberOfItems/numberPerPage)
                        $('#list').empty().append(response.pagination)
                    
                        buildPagination(currPage)
                    },
                error: function (xhr, status, error) 
                {
                    alert("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText)
                }
            });
        }

        $(document).ready(function()
        {
            buildPage(1)
            
            $('.paginator').on('click', 'button', function() 
            {
                var clickedPage = parseInt($(this).val())
                
                console.log(`Page clicked on ${clickedPage}`)
                buildPage(clickedPage)
            });
        });
</script>
<div class="example-wrapper">
    <h3 align="center">Logs</h3><br>
    <b><i>Log Type: </i></b>  <select id="logType" class="input-sm">
        <option>All</option>
        <option>Error Logs</option>
        <option>Success Logs</option>
    </select>
    <b><i>Module: </i></b>  <select id="module" class="input-sm">
        <option>All</option>
        <option>User</option>
        <option>Applications</option>
        <option>Job Postings</option>
    </select>
</div><br>
<table class="table table-hover table-bordered" >
    <thead align="center" class="text-uppercase"><tr class="info">
    <th class="text-primary">Log ID</th>
    <th class="text-primary">User ID</th>
    <th class="text-primary">Log Time</th>
    <th class="text-primary">Job ID</th>
    <th class="text-primary">Descritpion</th>
    </tr></thead>
    <tbody id="list" align="center"></tbody>
</table>
<div class='paginator'>

</div>
{% endblock %}
